{% extends 'base.html' %}
{% block content %}
<!-- Modal Delete -->
<div id="deleteModal"
    class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-[90%] max-w-lg text-center">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Apakah anda yakin ingin menghapus pertandingan ini?</h3>
        <p class="text-sm text-gray-600 mb-8">Tindakan ini tidak dapat dibatalkan.</p>
        <div class="flex justify-center gap-3">
            <button type="button" id="cancelDeleteBtn"
                class="px-4 py-2 border border-[var(--color-secondary)] text-[var(--color-secondary)] rounded hover:bg-gray-50">
                Batal
            </button>
            <button type="button" id="confirmDeleteBtn"
                class="px-4 py-2 w-full text-white rounded transition-all duration-200 bg-[var(--color-secondary)] hover:bg-[var(--color-primary)]">
                Hapus
            </button>
        </div>
    </div>
</div>

<script>
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    let deleteTargetLink = null;
    let deleteRedirectUrl = null;

    // menampilkan modal delete
    function showDeleteModal(event, id, deleteLink, redirectUrl) {
        event.stopPropagation();
        deleteTargetLink = deleteLink;
        deleteRedirectUrl = redirectUrl;
        deleteModal.classList.remove('hidden');
    }

    // menyembunyikan modal delete
    cancelDeleteBtn.addEventListener('click', () => {
        deleteModal.classList.add('hidden');
        deleteTargetLink = null;
        deleteRedirectUrl = null;
    });

    // konfirmasi delete
    confirmDeleteBtn.addEventListener('click', async () => {
        if (!deleteTargetLink) return;
        confirmDeleteBtn.disabled = true;
        confirmDeleteBtn.textContent = 'Deleting...';

        try {
            const response = await fetch(deleteTargetLink, { method: 'POST', headers: { 'X-CSRFToken': getCSRFToken() } });
            if (!response.ok) throw new Error("Failed to delete match");

            deleteModal.classList.add('hidden');
            if (deleteRedirectUrl) {
                sessionStorage.setItem('toastMessage', 'Match deleted successfully!');
                sessionStorage.setItem('toastType', 'success');
                window.location.href = deleteRedirectUrl;
            } else {
                showToast("Match deleted successfully!", "success");
                if (typeof fetchMatches === 'function') {
                    fetchMatches(); 
                }
            }
        } catch (error) {
            console.error(error);
            showToast("Failed to delete match.", "error");
        } finally {
            confirmDeleteBtn.disabled = false;
            confirmDeleteBtn.textContent = 'Delete';
            deleteTargetLink = null;
            deleteRedirectUrl = null;
        }
    });

    // ambil CSRF token
    function getCSRFToken() {
        const csrfToken = document.cookie.split('; ').find(row => row.startsWith('csrftoken='));
        return csrfToken ? csrfToken.split('=')[1] : '';
    }

    // klik di luar modal untuk menutup
    deleteModal.addEventListener('click', (e) => {
        if (e.target === deleteModal) {
            deleteModal.classList.add('hidden');
            deleteTargetLink = null;
        }
    });
</script>
{% endblock content %}