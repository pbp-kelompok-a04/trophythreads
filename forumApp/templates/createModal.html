<div id="createThreadModal"
    class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
    <div id="createThreadModalContent"
        class="bg-white rounded-lg shadow-lg w-11/12 sm:w-3/5 md:w-1/2 max-h-[90vh] overflow-y-auto p-6">

        <!-- Header -->
        <div class="flex items-center justify-between border-b pb-4 mb-4">
            <div>
                <h3 class="text-lg font-semibold text-gray-900">Buat thread baru</h3>
                <p class="text-sm text-gray-600">Buat thread tentang apapun seputar sepak bola Indonesia!</p>
            </div>
            <button onclick="hideCreateThreadModal()" class="text-gray-600 hover:text-gray-900 text-xl">&times;</button>
        </div>

        <!-- Form -->
        <form id="createThreadForm">
            {% csrf_token %}
            
            <!-- Title -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                <input type="text" id="thread_title" required
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-400 focus:outline-none">
            </div>

            <!-- Content -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                <textarea id="thread_content" rows="7" required
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-400 focus:outline-none"></textarea>
            </div>

            <!-- Error Message -->
            <div id="createThreadError" class="hidden mb-4 p-3 bg-red-100 text-red-700 rounded"></div>

            <!-- Buttons -->
            <div class="flex justify-between sm:justify-end gap-3">
                <button type="button" onclick="hideCreateThreadModal()"
                    class="px-5 py-2 border border-red-300 text-red-600 rounded hover:bg-red-50 transition">
                    Cancel
                </button>
                <button type="submit" id="submitThreadBtn"
                    class="px-5 py-2 bg-[#E63946] text-white rounded hover:bg-[#D62828] transition font-semibold">
                    Create Thread
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showCreateThreadModal() {
  const modal = document.getElementById("createThreadModal");
  modal.classList.remove("hidden");
  document.body.classList.add("overflow-hidden");
}

function hideCreateThreadModal() {
  const modal = document.getElementById("createThreadModal");
  modal.classList.add("hidden");
  document.body.classList.remove("overflow-hidden");
  document.getElementById('thread_title').value = '';
  document.getElementById('thread_content').value = '';
  document.getElementById('createThreadError').classList.add('hidden');
}

document.getElementById('createThreadForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const title = document.getElementById('thread_title').value.trim();
    const content = document.getElementById('thread_content').value.trim();
    const errorDiv = document.getElementById('createThreadError');
    const submitBtn = document.getElementById('submitThreadBtn');

    // Validation
    if (!title || !content) {
        errorDiv.textContent = 'Title and content are required.';
        errorDiv.classList.remove('hidden');
        return;
    }

    // Hide previous errors
    errorDiv.classList.add('hidden');

    // Disable button during submission
    submitBtn.disabled = true;
    submitBtn.textContent = 'Creating...';

    try {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        const response = await fetch("{% url 'forumApp:create_forum' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                'title': title,
                'content': content
            })
        });

        const data = await response.json();

        if (response.ok) {
            // Success
            showToast("Thread created successfully!","success")
            hideCreateThreadModal();
            
            // Reload threads list if on landing page
            if (typeof fetchThreads === 'function') {
                fetchThreads();
            } else {
                // Redirect to forum page if not on landing page
                window.location.href = "{% url 'forumApp:show_landing_page' %}";
            }
        } else {
            // Error from server
            errorDiv.textContent = data.error || 'Failed to create thread.';
            errorDiv.classList.remove('hidden');
        }
    } catch (err) {
        console.error('Error:', err);
        errorDiv.textContent = 'Error. Please try again.';
        errorDiv.classList.remove('hidden');
    } finally {
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Thread';
    }
});
</script>