{% extends 'base.html' %}
{% load static %}

{% block meta %}
  <title>Membuat Pesanan â€” Sedang Diproses</title>
{% endblock meta %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#FFF5F5] to-[#FFECEC]">
  <div class="w-full max-w-xl p-8 rounded-2xl bg-white shadow-lg text-center">
    <div class="mb-6">
      <div class="mx-auto w-28 h-28 rounded-full flex items-center justify-center shadow-inner relative">
        <svg class="animate-spin w-20 h-20" viewBox="0 0 50 50">
          <circle cx="25" cy="25" r="20" stroke-width="6" stroke="#FF7A5C" stroke-opacity="0.15" fill="none"></circle>
          <path d="M43.6 25a18.6 18.6 0 0 1-3.2 10.7" stroke="#ED3F27" stroke-width="6" stroke-linecap="round" fill="none"></path>
        </svg>
      </div>
    </div>

    <h2 class="text-2xl font-bold text-[#ED3F27] mb-2">Sedang membuat pesanan...</h2>
    <p class="text-sm text-gray-600 mb-4">Tunggu sebentar - kami sedang memproses pesananmu.</p>

    <div class="mt-4">
      <div id="progressBar" class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="progressFill" class="h-2 rounded-full" style="width:0%; background: linear-gradient(90deg,#FF7A5C,#ED3F27); transition: width 1s ease;"></div>
      </div>
    </div>
  </div>
</div>

<script>
  (function(){
    const redirectUrl = "{{ redirect_url }}";
    const waitMs = "{{ wait_ms }}"; 
    const progress = document.getElementById('progressFill');

    // animate progress bar
    setTimeout(()=> progress.style.width = "70%", 100);
    setTimeout(()=> progress.style.width = "100%", waitMs - 100);

    // setelah timeout navigasi ke after_checkout
    setTimeout(()=>{
      window.location.href = redirectUrl;
    }, waitMs);
  })();
</script>

<style>
  /* spinner animation fallback */
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .animate-spin { animation: spin 1s linear infinite; }
</style>
{% endblock content %}
